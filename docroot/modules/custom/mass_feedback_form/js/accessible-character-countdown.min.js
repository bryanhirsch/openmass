"use strict";!function(e){e.fn.accessibleCharCount=function(r){var t=e.extend(!0,{},e.fn.accessibleCharCount.defaults,r);function m(e){var r=e.value.length;return e.getAttribute("maxlength")-r}function a(e,r){var t={beforeNumberElem:"",numberElem:"",afterNumberElem:""},m=document.documentElement.getAttribute("lang");if(m||(m="en"),m in e.beforeNumberElem.html){var a=e.beforeNumberElem.html[m];r>=a.length?t.beforeNumberElem=a[a.length-1]:t.beforeNumberElem=a[r]}else t.beforeNumberElem="";if(t.numberElem=r,m in e.afterNumberElem.html){var l=e.afterNumberElem.html[m];if(r>=l.length){var n=l.length-1;t.afterNumberElem=l[n]}else t.afterNumberElem=l[r]}else t.afterNumberElem="";return t}return"en"in t.beforeNumberElem.html?"string"==typeof t.beforeNumberElem.html.en&&(t.beforeNumberElem.html.en=[t.beforeNumberElem.html.en]):t.beforeNumberElem.html.en=[""],"fr"in t.beforeNumberElem.html?"string"==typeof t.beforeNumberElem.html.fr&&(t.beforeNumberElem.html.fr=[t.beforeNumberElem.html.fr]):t.beforeNumberElem.html.fr=[""],"en"in t.afterNumberElem.html?"string"==typeof t.afterNumberElem.html.en&&(t.afterNumberElem.html.en=[t.afterNumberElem.html.en]):t.afterNumberElem.html.en=[" characters remaining"," character remaining"," characters remaining"],"fr"in t.afterNumberElem.html?"string"==typeof t.afterNumberElem.html.fr&&(t.afterNumberElem.html.fr=[t.afterNumberElem.html.fr]):t.afterNumberElem.html.fr=[" caractères restants"," caractère restant"," caractères restants"],this.each(function(){if(void 0===this.value)return console.log("Unable to attach a character counter to the following element:"),console.log(this),!1;var r=e(this).attr("maxlength");isNaN(r)?e(this).attr("maxlength",t.maxLength):t.maxLength=r;var l,n=m(this),b=a(t,n),i=(l=9999,Math.floor(Math.random()*l)),s=e("<span></span>").attr(t.beforeNumberElem.attrs).css(t.beforeNumberElem.css).html(b.beforeNumberElem),u=t.numberElem.idPrefix+i,f=e("<span></span>",{id:u}).attr(t.numberElem.attrs).css(t.numberElem.css).html(b.numberElem),o=e("<span></span>").attr(t.afterNumberElem.attrs).css(t.afterNumberElem.css).html(b.afterNumberElem),h=t.wrapperElem.idPrefix+i,c=e("<div></div>",{id:h}).attr(t.wrapperElem.attrs).attr("aria-live","polite").css(t.wrapperElem.css).append(s).append(f).append(o).insertAfter(e(this));e(this).attr("aria-describedby",h);var E={beforeNumberElem:b.beforeNumberElem,numberElem:b.numberElem,afterNumberElem:b.afterNumberElem};function N(e){var r,l=m(e),n=a(t,l);return n.beforeNumberElem!==E.beforeNumberElem&&(s.html(n.beforeNumberElem),E.beforeNumberElem=n.beforeNumberElem),n.numberElem!==E.numberElem&&(f.html(n.numberElem),E.numberElem=n.numberElem),n.afterNumberElem!==E.afterNumberElem&&(o.html(n.afterNumberElem),E.afterNumberElem=n.afterNumberElem),l===t.maxLength?(r="polite",c.attr("aria-live","polite"),c.attr("aria-atomic",!0)):l>t.triggerPolite?(r="off",c.attr("aria-live","off"),c.attr("aria-atomic",!0)):l>t.triggerAssertive?(r="polite",c.attr("aria-live","polite"),t.everyNth>0&&(l%t.everyNth==0?c.attr("aria-atomic",!0):c.attr("aria-atomic",!1))):(r="assertive",c.attr("aria-live","assertive"),c.attr("aria-atomic",!0),0===l&&t.atMaxLength.call(e)),{remaining:l,status:r}}e(this).on("keyup",function(e){t.beforeUpdate.call(this);var r=N(this);t.afterUpdate.call(this,r.remaining,r.status)});var p=this;new window.MutationObserver(function(e){e.forEach(function(e){"attributes"===e.type&&"lang"===e.attributeName&&N(p)})}).observe(document.documentElement,{attributes:!0})})},e.fn.accessibleCharCount.defaults={maxLength:160,triggerPolite:50,triggerAssertive:20,everyNth:5,wrapperElem:{idPrefix:"accessibleCharCount-wrapper-",attrs:{class:"accessibleCharCount-wrapperElem"},css:{}},beforeNumberElem:{attrs:{class:"accessibleCharCount-beforeNumberElem"},css:{},html:{}},numberElem:{idPrefix:"accessibleCharCount-number-",attrs:{class:"accessibleCharCount-numberElem"},css:{}},afterNumberElem:{attrs:{class:"accessibleCharCount-afterNumberElem visually-hidden"},css:{},html:{}},beforeUpdate:function(){},afterUpdate:function(){},atMaxLength:function(){}}}(jQuery);
